#!/usr/bin/env bash

bin=`which $0`
bin=`dirname ${bin}`
bin=`cd "$bin"; pwd`

echo ""
function  print_usage() {
  echo "Usage:"
  echo "clic -command"
  echo "where command is one of:"
  echo "     -list_task           get task list"
  echo "     -version         print the version"
  echo "     -help               show the usage"
  echo ""
}
if [ $# = 0 ]; then
  print_usage
  exit
fi

command=$1
shift
case $command in
  --help|-help|-h)
    print_usage
    exit
    ;;
esac
#set CLASSPATH and get conf
if [ -d "$CLIC_HOME/" ]; then
  PATH=$CLIC_HOME/jars
  config="/data/conf/master-info.config"
  . $config
elif [ -d "/data/jars" ]; then
  PATH=/data/jars
  if [ -f "/data/conf/master-info.properties" ]; then
       config="/data/conf/master-info.config"
       . $config
  else
     echo  "Error: CLIC config is not found."
  fi
else
  echo  "Error: CLIC service is not found."
fi
#set master ip&port
master_host="${ip}"
master_port="${port}"


#core command
if [ "$command" = "-list_task" ]; then
  CLASS=fdu.daslab.shellservice.ShellGetTaskList
  PATH=$PATH/"clic-shell-test.jar"
elif [ "$command" = "-version" ]; then
  CLASS=fdu.daslab.shellservice.ShellGetVersionInfo
  PATH=$PATH/"clic-shell-test.jar"
else
  echo $command - invalid command
  print_usage
  exit 1
fi

#some java parameters
if [ "$JAVA_HOME" != "" ]; then
  JAVA=$JAVA_HOME/bin/java
else
  echo "Error: JAVA_HOME is not set."
  exit 1
fi
JAVA_HEAP_MAX=-Xmx1000m
eval exec "$JAVA" $JAVA_HEAP_MAX  -classpath $PATH $CLASS "$@" $master_host $master_port
